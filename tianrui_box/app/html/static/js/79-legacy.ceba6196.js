"use strict";(self.webpackChunkweb_client_video_gateway=self.webpackChunkweb_client_video_gateway||[]).push([[79],{21146:function(t,e,a){a.r(e),a.d(e,{default:function(){return i}}),a(41539),a(54747);e=a(15002);var r=a(94351),i=(e={components:{MapViewer:e.g},data:function(){return{loading:!1,searchLoading:!1,activeName:"first",dutyOptions:[],listQuery:{car_code:void 0,st_time:void 0,et_time:void 0},startOccurDatePicker:this.beginOccurStartTime(),endOccurDatePicker:this.processOccurEndTime(),ruleForm:{st_time:[{required:!0,message:"请选择开始时间",trigger:"change"}],et_time:[{required:!0,message:"请选择结束时间",trigger:"change"}],car_code:{required:!0,message:"请输入车牌号",trigger:"blur"}},data:[],defaultProps:{children:"children",label:"label"}}},mounted:function(){this.getCar()},methods:{getCar:function(){var t=this;this.dutyOptions=[],(0,r.getDevices)().then((function(e){200===e.code&&e.data.forEach((function(e){t.dutyOptions.push(e.car_code)}))})).catch((function(t){}))},getList:function(){var t=this,e={car_code:this.listQuery.car_code,st_time:new Date(this.listQuery.st_time).getTime()/1e3,et_time:new Date(this.listQuery.et_time).getTime()/1e3},a=this;this.data=[],(0,r.getTraceView)(e).then((function(e){var r;200===e.code&&(a.data=e.data,r={car_code:void 0,lineArr:[]},a.data&&0<a.data.length?(a.data.forEach((function(t){var e;0!==t.lng&&0!==t.lat&&(e=a.wgs_gcj_encrypts(t.lat,t.lng),r.car_code=t.car_code,r.lineArr.push([e.lng,e.lat]))})),a.$nextTick((function(t){var e=r.lineArr[0];a.$refs.mapItem.trackMove(e,r.lineArr)}))):a.$refs.mapItem.clearMarkersChlidren()),t.searchLoading=!1})).catch((function(e){t.searchLoading=!1}))},wgs_gcj_encrypts:function(t,e){var a=3.141592653589793,r=6378245,i=.006693421622965943,s={};if(n=t,(c=e)<72.004||137.8347<c||n<.8293||55.8271<n)return s.lat=t,s.lng=e,s;l=2*(c=e-105)-100+3*(n=t-35)+.2*n*n+.1*c*n+.2*Math.sqrt(Math.abs(c));var c=(l+=2*(20*Math.sin(6*c*a)+20*Math.sin(2*c*a))/3)+2*(20*Math.sin(n*a)+40*Math.sin(n/3*a))/3+2*(160*Math.sin(n/12*a)+320*Math.sin(n*a/30))/3,n=(n=300+(l=e-105)+2*(n=t-35)+.1*l*l+.1*l*n+.1*Math.sqrt(Math.abs(l)),(n+=2*(20*Math.sin(6*l*a)+20*Math.sin(2*l*a))/3)+2*(20*Math.sin(l*a)+40*Math.sin(l/3*a))/3+2*(150*Math.sin(l/12*a)+300*Math.sin(l/30*a))/3),l=t/180*a,o=1-i*(o=Math.sin(l))*o,d=Math.sqrt(o);c=180*c/(r*(1-i)/(o*d)*a),i=e+180*n/(r/d*Math.cos(l)*a);return s.lat=t+c,s.lng=i,s},handleTabs:function(){},searchTarck:function(){var t=this;this.searchLoading=!0,this.$refs.mapItem&&this.$refs.mapItem.clearMarkersChlidren(),this.$refs.callBackForm.validate((function(e){e?t.getList():t.searchLoading=!1}))},restTarck:function(){this.listQuery={car_code:void 0,st_time:void 0,et_time:void 0},this.$refs.callBackForm&&this.$refs.callBackForm.resetFields(),this.$refs.mapItem.clearMarkersChlidren()},beginOccurStartTime:function(){var t=this;return{disabledDate:function(e){return new Date(t.listQuery.et_time).getTime()<e.getTime()||e.getTime()>Date.now()}}},processOccurEndTime:function(){var t=this;return{disabledDate:function(e){return new Date(t.listQuery.st_time)-864e5>e.getTime()||e.getTime()>Date.now()}}},nodeChange:function(t,e,a){var r;this.$refs.mapItem&&(r=t.lineArr[0],e?this.$refs.mapItem.trackMove(r,t.lineArr):this.$refs.mapItem.clearMarkersChlidren())}}},(0,a(43736).Z)(e,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"page"},[a("div",{staticClass:"contetn-map"},[a("div",{staticClass:"left"},[a("div",{staticClass:"bus-titlt"},[t._v("轨迹查询")]),a("div",{staticClass:"search-list"},[a("el-form",{ref:"callBackForm",staticClass:"callBackForm",attrs:{rules:t.ruleForm,model:t.listQuery,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"车牌号：",prop:"car_code"}},[a("el-select",{attrs:{placeholder:"请选择车牌号"},model:{value:t.listQuery.car_code,callback:function(e){t.$set(t.listQuery,"car_code",e)},expression:"listQuery.car_code"}},t._l(t.dutyOptions,(function(t,e){return a("el-option",{key:e,attrs:{label:t,value:t}})})),1)],1),a("el-form-item",{attrs:{label:"开始时间：",prop:"st_time"}},[a("el-date-picker",{attrs:{format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss",type:"datetime","picker-options":t.startOccurDatePicker,placeholder:"请选择开始时间"},model:{value:t.listQuery.st_time,callback:function(e){t.$set(t.listQuery,"st_time",e)},expression:"listQuery.st_time"}})],1),a("el-form-item",{attrs:{label:"结束时间：",prop:"et_time"}},[a("el-date-picker",{attrs:{format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss",type:"datetime","picker-options":t.endOccurDatePicker,placeholder:"请选择日期时间"},model:{value:t.listQuery.et_time,callback:function(e){t.$set(t.listQuery,"et_time",e)},expression:"listQuery.et_time"}})],1)],1),a("div",{staticClass:"eg-botton"},[a("el-button",{attrs:{type:"primary"},on:{click:t.restTarck}},[t._v("重置")]),a("el-button",{attrs:{type:"primary",loading:t.searchLoading},on:{click:t.searchTarck}},[t._v("查询")])],1)],1)]),a("MapViewer",{ref:"mapItem",staticClass:"map-content",attrs:{zoom:12,domMap:"containerTrack",checkShow:!0}})],1)])}),[],!1,null,"01efccc0",null).exports)}}]);