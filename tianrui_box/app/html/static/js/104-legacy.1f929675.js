(self.webpackChunkweb_client_video_gateway=self.webpackChunkweb_client_video_gateway||[]).push([[104],{54104:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return n}}),i(41539),i(54747);var s=i(94351),n=(t=(i(9653),i(68309),i(74916),i(23123),i(75505),i(87714),i(82801),i(1174),i(82472),i(48675),i(92990),i(18927),i(33105),i(35035),i(74345),i(7174),i(32846),i(44731),i(77209),i(96319),i(58867),i(37789),i(33739),i(29368),i(14483),i(12056),i(3462),i(30678),i(27462),i(33824),i(55021),i(12974),i(15016),i(78783),i(33948),i(60285),i(41637),{name:"jessibuca",data:function(){return{jessibuca:null,playing:!1,isNotMute:!1,quieting:!1,fullscreen:!1,loaded:!1,speed:0,performance:"",kBps:0,btnDom:null,videoInfo:null,volume:1,rotate:0,vod:!0,forceNoOffscreen:!1}},props:["videoUrl","error","hasAudio","height"],mounted:function(){var e=this,t=(window.onerror=function(e){},decodeURIComponent(this.$route.params.url)),i=this;this.$nextTick((function(){var s=document.getElementById("container");s.style.height=9/16*s.clientWidth+"px",void 0===e.videoUrl&&(i.videoUrl=t),e.btnDom=document.getElementById("buttonsBox"),e.play(e.videoUrl)}))},watch:{videoUrl:function(e,t){this.play(e)},immediate:!0},methods:{create:function(){this.jessibuca=new window.Jessibuca(Object.assign({container:this.$refs.container,videoBuffer:.2,isResize:!0,decoder:"/jessibuca/decoder.js",useMSE:!1,showBandwidth:!1,isFlv:!0,loadingText:"加载中",hasAudio:void 0===this.hasAudio||this.hasAudio,debug:!1,supportDblclickFullscreen:!1,operateBtns:{fullscreen:!1,screenshot:!1,play:!1,audio:!1,recorder:!1},record:"record",vod:this.vod,forceNoOffscreen:this.forceNoOffscreen,isNotMute:this.isNotMute},{}));var e=this;this.jessibuca.on("load",(function(){})),this.jessibuca.on("log",(function(e){})),this.jessibuca.on("record",(function(e){})),this.jessibuca.on("pause",(function(){e.playing=!1})),this.jessibuca.on("play",(function(){e.playing=!0})),this.jessibuca.on("fullscreen",(function(t){e.fullscreen=t})),this.jessibuca.on("mute",(function(t){e.isNotMute=!t})),this.jessibuca.on("audioInfo",(function(e){})),this.jessibuca.on("videoInfo",(function(e){})),this.jessibuca.on("bps",(function(e){})),this.jessibuca.on("timeUpdate",(function(e){})),this.jessibuca.on("videoInfo",(function(e){})),this.jessibuca.on("error",(function(e){})),this.jessibuca.on("timeout",(function(){})),this.jessibuca.on("start",(function(){})),this.jessibuca.on("performance",(function(t){var i="卡顿";2===t?i="非常流畅":1===t&&(i="流畅"),e.performance=i})),this.jessibuca.on("buffer",(function(e){})),this.jessibuca.on("stats",(function(e){})),this.jessibuca.on("kBps",(function(t){e.kBps=Math.round(t)})),this.jessibuca.on("videoFrame",(function(){})),this.jessibuca.on("metadata",(function(){}))},playBtnClick:function(e){this.play(this.videoUrl)},play:function(e){var t=this;this.jessibuca&&this.destroy(),this.create(),this.jessibuca.on("play",(function(){t.playing=!0,t.loaded=!0,t.quieting=t.jessibuca.quieting})),this.jessibuca.hasLoaded()?this.jessibuca.play(e):this.jessibuca.on("load",(function(){t.jessibuca.play(e)})),setTimeout((function(e){t.pause(),t.$emit("videoPause")}),6e4)},pause:function(){this.jessibuca&&this.jessibuca.pause(),this.playing=!1,this.err="",this.performance=""},destroy:function(){this.jessibuca&&this.jessibuca.destroy(),null==document.getElementById("buttonsBox")&&document.getElementById("container").appendChild(this.btnDom),this.jessibuca=null,this.playing=!1,this.err="",this.performance=""},eventcallbacK:function(e,t){},fullscreenSwich:function(){var e=this.isFullscreen();this.jessibuca.setFullscreen(!e),this.fullscreen=!e},isFullscreen:function(){return document.fullscreenElement||document.msFullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||!1}},destroyed:function(){this.jessibuca&&this.jessibuca.destroy(),this.playing=!1,this.loaded=!1,this.performance=""}}),i=i(43736),t={components:{player:(0,i.Z)(t,(function(){var e=this,t=e.$createElement;t=e._self._c||t;return t("div",{staticClass:"jess-page",attrs:{id:"jessibuca"}},[t("div",{ref:"container",staticClass:"jess-content",attrs:{id:"container"},on:{dblclick:e.fullscreenSwich}},[t("div",{staticClass:"buttons-box",attrs:{id:"buttonsBox"}},[t("div",{staticClass:"buttons-box-left"},[e.playing?e._e():t("i",{staticClass:"iconfont jessibuca-btn",on:{click:e.playBtnClick}},[e._v("")]),e.playing?t("i",{staticClass:"iconfont jessibuca-btn",on:{click:e.pause}},[e._v("")]):e._e(),t("i",{staticClass:"iconfont icon-stop jessibuca-btn",on:{click:e.destroy}}),e.isNotMute?t("i",{staticClass:"iconfont jessibuca-btn",on:{click:function(t){return e.jessibuca.mute()}}},[e._v("")]):e._e(),e.isNotMute?e._e():t("i",{staticClass:"iconfont jessibuca-btn",on:{click:function(t){return e.jessibuca.cancelMute()}}},[e._v("")])]),t("div",{staticClass:"buttons-box-right"},[t("span",{staticClass:"jessibuca-btn"},[e._v(e._s(e.kBps)+" kb/s")]),t("i",{staticClass:"iconfont jessibuca-btn",staticStyle:{"font-size":"1rem !important"},on:{click:function(t){return e.jessibuca.screenshot("截图","png",.5)}}},[e._v("")]),t("i",{staticClass:"el-icon-refresh-right jessibuca-btn",on:{click:e.playBtnClick}}),e.fullscreen?e._e():t("i",{staticClass:"iconfont jessibuca-btn",on:{click:e.fullscreenSwich}},[e._v("")]),e.fullscreen?t("i",{staticClass:"iconfont jessibuca-btn",on:{click:e.fullscreenSwich}},[e._v("")]):e._e()])])])])}),[],!1,null,"54cec62e",null).exports},props:{videoUrl:{type:Object,default:function(){}},index:{type:Number,default:0},playerIdx:{type:Number,default:0},cellCount:{type:Number,default:0}},data:function(){return{textName:[],videoUrlArr:[],isVideo:[!1],isShow:!1,textPause:"无信号",currentTimeVal:0,currentSpeed:0}},mounted:function(){this.videoUrl&&(this.videoUrlArr=this.videoUrl.video,this.textName=this.videoUrl.name)},watch:{cellCount:function(e){for(var t=1;t<=e;t++)this.$refs["player"+t]},videoUrl:{deep:!0,handler:function(e,t){this.videoUrl&&(this.videoUrlArr=this.videoUrl.video,this.textName=this.videoUrl.name,this.$set(this.isVideo,this.playerIdx+1,!0))}}},methods:{closedVidoe:function(){var e=this,t="player"+this.index;this.$refs[t].destroy(),this.$nextTick((function(t){e.$set(e.isVideo,e.playerIdx+1,!1)})),this.textPause="无信号"},videoPause:function(){this.textPause="视频播放完毕",this.$set(this.isVideo,this.playerIdx+1,!1)},shot:function(e){var t=document.createElement("a");e=function(e){e=e.split(";base64,");for(var t=e[0].split(":")[1],i=window.atob(e[1]),s=i.length,n=new Uint8Array(s),a=0;a<s;++a)n[a]=i.charCodeAt(a);return new Blob([n],{type:t})}(e);document.createEvent("HTMLEvents").initEvent("click",!0,!0),t.download="截图",t.href=URL.createObjectURL(e),t.click()}}},t={components:{VideoPlayer:(0,i.Z)(t,(function(){var e=this,t=e.$createElement;t=e._self._c||t;return t("div",{staticClass:"player"},[e.videoUrlArr[e.index-1]&&e.isVideo[e.index]?e.videoUrlArr[e.index-1]&&e.isVideo[e.index]?t("div",{staticClass:"player-name"},[e._v(" "+e._s(e.textName[e.index-1])+" "),t("span",{staticClass:"close-icon"},[t("i",{staticClass:"iconfont",on:{click:e.closedVidoe}},[e._v("")])])]):e._e():t("div",{staticClass:"no-information"},[e._v(e._s(e.textPause))]),e.videoUrlArr[e.index-1]&&e.isVideo[e.index]?t("div",{staticClass:"player-content"},[t("div",{staticClass:"video-player"},[t("player",{ref:"player"+e.index,attrs:{videoUrl:e.videoUrlArr[e.index-1],fluent:"",autoplay:"",height:!0,idx:"player"+e.index},on:{screenshot:e.shot,videoPause:e.videoPause}})],1)]):e._e()])}),[],!1,null,"04d488bd",null).exports},props:{activeIndex:{type:Number,default:function(){return 1}},splitHeader:{type:Array,default:function(){return[{text:"单画面",url:1},{text:"四分屏",url:4},{text:"反L型",url:6},{text:"九分屏",url:9},{text:"十六分屏",url:16}]}}},data:function(){return{playerIdx:0,splitList:[],videoUrl:[""],videoName:[""],activeNameIndex:0,videoObj:{obj:{},name:[],video:[]},cellCount:1}},computed:{cellClass:function(){return function(e){switch(this.cellCount){case 1:return["cell-player-1"];case 4:return["cell-player-4"];case 6:return 1===e?["cell-player-6-1"]:2===e?["cell-player-6-2"]:3===e?["cell-player-6-3"]:["cell-player-6"];case 9:return["cell-player-9"];case 16:return["cell-player-16"]}}}},mounted:function(){var e=this;this.cellCount=this.activeIndex,this.splitList=this.splitHeader,this.$on("changeData",(function(t){e.videoObj.obj=t,e.handleVideo(t)}))},methods:{handleVideo:function(e){var t=this.playerIdx;this.$set(this.videoUrl,t,e.flv_url),this.$set(this.videoName,t,e.car_code),this.videoObj.video=this.videoUrl,this.videoObj.name=this.videoName},handleSelect:function(e,t){this.cellCount=e,this.activeNameIndex=t}}},t=(0,i.Z)(t,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"cell"},[i("div",{staticClass:"right-page_top"},[e._v(" 选择显示模式： "),e._l(e.splitList,(function(t,s){return i("div",{key:s,staticClass:"model-list",class:e.activeNameIndex===s?"active":"",on:{click:function(i){return e.handleSelect(t.url,s)}}},[1===t.url?i("i",{staticClass:"iconfont"},[e._v("")]):4===t.url?i("i",{staticClass:"iconfont"},[e._v("")]):6===t.url?i("i",{staticClass:"iconfont"},[e._v("")]):e._e()])}))],2),i("div",{staticClass:"cell-player"},e._l(e.cellCount,(function(t){return i("div",{key:t,class:[e.cellClass(t),{redborder:e.playerIdx===t-1}],on:{click:function(i){e.playerIdx=t-1}}},[6!==e.cellCount?i("video-player",{attrs:{videoUrl:e.videoObj,playerIdx:e.playerIdx,cellCount:e.cellCount,index:t}}):e._e(),6==e.cellCount&&2!==t&&3!==t?i("video-player",{attrs:{videoUrl:e.videoObj,cellCount:e.cellCount,playerIdx:e.playerIdx,index:t}}):e._e(),6===e.cellCount&&2===t?i("video-player",{attrs:{videoUrl:e.videoObj,index:t,playerIdx:e.playerIdx,cellCount:e.cellCount}}):e._e(),6===e.cellCount&&3===t?i("video-player",{attrs:{videoUrl:e.videoObj,index:t,playerIdx:e.playerIdx,cellCount:e.cellCount}}):e._e()],1)})),0)])}),[],!1,null,"fc7507fc",null).exports,(0,i.Z)({components:{SplitScreen:t},data:function(){return{dataTree:[],defaultPropsName:{children:"children",label:"car_code"},objList:{device_uuids:[],play:1},online:0,offline:0,activeIndex:0,nameList:[],itemNmae:""}},mounted:function(){this.getChannel()},methods:{getChannel:function(){var e=this;this.dataTree=[],(0,s.getDevicesV2)().then((function(t){e.online=0,200===t.code&&(e.dataTree=t.data,e.dataTree.forEach((function(t,i){t.disabled=!0,1===t.status&&(t.disabled=!1,e.online++)})),e.offline=e.dataTree.length-e.online)})).catch()},handleNameClick:function(e,t){e.disabled||(this.objList.device_uuids=[e.device_uuid+""],(0,s.getVideoPlay)(this.objList).then((function(e){})).catch(),this.$refs.screen.$emit("changeData",e))}}},(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"real-page"},[i("el-row",{staticClass:"left-page"},[i("el-col",{staticClass:"left-page-tree"},[i("div",{staticClass:"left-head left-page-tree_title"},[e._v("视频服务")]),i("div",{staticClass:"g-flex-between left-page-tree_line"},[i("div",[i("i",{staticClass:"iconfont",staticStyle:{color:"#3f76ff"}},[e._v("")]),e._v(" 在线 ： "),i("span",{staticClass:"online-num"},[e._v(e._s(e.online))])]),i("div",[i("i",{staticClass:"iconfont",staticStyle:{color:"#e83f3f"}},[e._v("")]),e._v(" 离线 ： "),i("span",{staticClass:"noline-num"},[e._v(e._s(e.offline))])])]),i("div",{staticClass:"left-page-tree_content"},[i("el-tree",{staticClass:"text-tree",attrs:{data:e.dataTree,"node-key":"id","check-on-click-node":"",props:e.defaultPropsName},on:{"node-click":e.handleNameClick},scopedSlots:e._u([{key:"default",fn:function(t){return t=t.node,[i("div",{staticClass:"tree-label"},[t.disabled?i("span",{staticClass:"disabled-list"},[i("i",{staticClass:"iconfont"},[e._v("")]),e._v(" "+e._s(t.label)+" ")]):i("span",{staticClass:"tree-list"},[i("i",{staticClass:"iconfont"},[e._v("")]),e._v(" "+e._s(t.label)+" ")])])]}}])})],1)])],1),i("div",{staticClass:"right-page"},[i("SplitScreen",{ref:"screen",attrs:{isLive:!0}})],1)],1)}),[],!1,null,"150d394b",null).exports)},75505:function(e,t,i){var s=i(82109),n=i(35005),a=i(1702),o=i(47293),l=i(41340),c=i(92597),r=i(48053),u=i(14170).ctoi,d=/[^\d+/a-z]/i,f=/[\t\n\f\r ]+/g,h=/[=]+$/,v=n("atob"),p=String.fromCharCode,b=a("".charAt),m=a("".replace),y=a(d.exec),C=(i=o((function(){return""!==v(" ")})),a=!o((function(){v("a")})),!i&&!a&&!o((function(){v()}))),j=!i&&!a&&1!==v.length;s({global:!0,enumerable:!0,forced:i||a||C||j},{atob:function(e){if(r(arguments.length,1),C||j)return v(e);var t,i,s=m(l(e),f,""),a="",o=0,_=0;if((s=s.length%4==0?m(s,h,""):s).length%4==1||y(d,s))throw new(n("DOMException"))("The string is not correctly encoded","InvalidCharacterError");for(;t=b(s,o++);)c(u,t)&&(i=_%4?64*i+u[t]:u[t],_++%4&&(a+=p(255&i>>(-2*_&6))));return a}})}}]);