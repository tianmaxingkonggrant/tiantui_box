"use strict";(self.webpackChunkweb_client_video_gateway=self.webpackChunkweb_client_video_gateway||[]).push([[92],{12786:function(e,t,a){a.r(t),a.d(t,{default:function(){return i}}),a(41539),a(54747),a(38862),a(56977),a(68309);t=a(15002);var l=a(94351),i=(t={components:{MapViewer:t.g},data:function(){return{option:{disabledDate:function(e){return e.getTime()<Date.now()-864e5}},vlaue:"",activeName:"first",mapDialog:!1,isCheck:!1,callBackForm:{timeAll:"",name:void 0,rule:void 0,rule_gps:void 0,st_time:void 0,et_time:void 0},ruleForm:{timeAll:[{required:!0,message:"请选择有效时间",trigger:"change"}],name:{required:!0,message:"请输入围栏名称",trigger:"blur"}},fenceList:[{key:1,value:"圆形围栏"},{key:2,value:"矩形围栏"},{key:3,value:"多边形围栏"}],title:"区域围栏告警",isShow:!1,filtersForm:{page:0,size:10,status:void 0},activeIndex:void 0,total:10,loading:!1,tableData:[],logColumns:[{width:"",prop:"name",flag:!0,label:"围栏名称"},{width:"",flag:!0,prop:"st_time",label:"开始时间"},{width:"",flag:!0,prop:"et_time",label:"结束时间"},{width:"",prop:"create_time",flag:!0,label:"创建时间"}]}},mounted:function(){this.activeIndex=void 0,this.getList()},methods:{getList:function(){var e=this;this.tableData=[],(0,l.getAlarmArea)().then((function(t){200===t.code&&(e.tableData=t.data)})).catch((function(e){}))},searchTarck:function(){this.getList()},addTarck:function(){this.isShow=!0,this.isCheck=!1},fenceClick:function(e,t){if(this.$refs.mapFence.endDraw(),this.activeIndex=e,this.$refs.mapFence)switch(this.title="区域围栏告警",t.key){case 1:this.$refs.mapFence.startDraw("circle");break;case 2:this.$refs.mapFence.startDraw("rectangle");break;case 3:this.$refs.mapFence.startDraw("polygon");break;case 4:this.title="超速围栏告警"}},drawClick:function(e){var t=this,a=(this.mapDialog=!0,{path:[],type:e.type}),l={};switch(e.type){case"polygon":e.path.forEach((function(e){e=t.wgs_gcj_encrypts(e[1],e[0]),e=[e.lng,e.lat],a.path.push(e)})),this.callBackForm.rule=JSON.stringify(e),this.callBackForm.rule_gps=JSON.stringify(a),this.callBackForm.type=3;break;case"circle":this.callBackForm.rule=JSON.stringify(e),l=this.wgs_gcj_encrypts(e.path[1],e.path[0]),a.path=[l.lng,l.lat],a.radius=e.radius,this.callBackForm.rule_gps=JSON.stringify(a),this.callBackForm.type=1;break;case"rectangle":this.callBackForm.rule=JSON.stringify(e),l.southWest=this.wgs_gcj_encrypts(e.southWest[1],e.southWest[0]),l.northEast=this.wgs_gcj_encrypts(e.northEast[1],e.northEast[0]),a.southWest=[l.southWest.lng,l.southWest.lat],a.northEast=[l.northEast.lng,l.northEast.lat],this.callBackForm.rule_gps=JSON.stringify(a),this.callBackForm.type=2}},wgs_gcj_encrypts:function(e,t){var a=3.141592653589793,l=.006693421622965943,i={};if(n=e,(s=t)<72.004||137.8347<s||n<.8293||55.8271<n)return i.lat=e,i.lng=t,i;r=2*(s=t-105)-100+3*(n=e-35)+.2*n*n+.1*s*n+.2*Math.sqrt(Math.abs(s));var s=(r+=2*(20*Math.sin(6*s*a)+20*Math.sin(2*s*a))/3)+2*(20*Math.sin(n*a)+40*Math.sin(n/3*a))/3+2*(160*Math.sin(n/12*a)+320*Math.sin(n*a/30))/3,n=(n=300+(r=t-105)+2*(n=e-35)+.1*r*r+.1*r*n+.1*Math.sqrt(Math.abs(r)),(n+=2*(20*Math.sin(6*r*a)+20*Math.sin(2*r*a))/3)+2*(20*Math.sin(r*a)+40*Math.sin(r/3*a))/3+2*(150*Math.sin(r/12*a)+300*Math.sin(r/30*a))/3),r=e/180*a,c=1-l*(c=Math.sin(r))*c,o=Math.sqrt(c);e-=180*s/(6378245*(1-l)/(c*o)*a),s=t-180*n/(6378245/o*Math.cos(r)*a);return i.lat=e.toFixed(7),i.lng=s.toFixed(7),i},handleAdd:function(){var e=this,t=this;this.$refs.callBackForm.validate((function(a){a&&(a={name:t.callBackForm.name,rule:t.callBackForm.rule,atype:t.callBackForm.type,rule_gps:t.callBackForm.rule_gps,st_time:new Date(t.callBackForm.timeAll[0]).getTime()/1e3,et_time:new Date(t.callBackForm.timeAll[1]).getTime()/1e3},(0,l.getAlarmAreaAdd)(a).then((function(t){200===t.data.code&&e.$message({message:"恭喜你，新增成功！",type:"success"}),e.mapDialog=!1})).catch((function(e){})))}))},handleDelete:function(e){var t=this;t.$confirm("此操作将删除该数据, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){(0,l.getAlarmAreaDelete)({aid:e.aid}).then((function(e){t.$message({type:"success",message:"删除成功!"}),t.getList()}))})).catch((function(){}))},handleClose:function(){this.mapDialog=!1,this.activeIndex=void 0,this.callBackForm={timeAll:"",name:void 0,rule:void 0,rule_gps:void 0,st_time:void 0,et_time:void 0},this.$refs.mapFence.endDraw(),this.$refs.callBackForm&&this.$refs.callBackForm.resetFields()},backTarck:function(){this.isShow=!1,this.$refs.mapFence.clearMarkersChlidren(),this.getList()},handleTabs:function(e){},handleCheck:function(e){this.isShow=!0,this.isCheck=!0,e=JSON.parse(e.rule),this.$refs.mapFence.trackShowMapView(e),this.$refs.mapFence.getAddCenterChlidren("",15)},handleSizeChange:function(e){this.filtersForm.page=0,this.filtersForm.size=e,this.getList()},handleCurrentChange:function(e){this.filtersForm.page=e-1,this.getList()}}},(0,a(43736).Z)(t,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page"},[a("div",{staticClass:"contetn-map"},[a("div",{staticClass:"top"},[e.isShow?e.isShow&&!e.isCheck?a("div",{staticClass:"eg-fence"},e._l(e.fenceList,(function(t,l){return a("div",{key:l,staticClass:"eg-fence-item",class:e.activeIndex===l?"active":"",on:{click:function(a){return e.fenceClick(l,t)}}},[e._v(e._s(t.value))])})),0):e._e():a("div",[a("div",{staticClass:"eg-search"},[a("label",{staticClass:"eg-label"},[e._v("围栏名称：")]),a("el-input",{attrs:{placeholder:"请输入围栏名称"},model:{value:e.vlaue,callback:function(t){e.vlaue=t},expression:"vlaue"}})],1)]),a("div",{staticClass:"eg-add"},[e.isShow?e._e():a("el-button",{attrs:{type:"primary"},on:{click:e.searchTarck}},[e._v("查询")]),e.isShow?a("el-button",{attrs:{type:"primary"},on:{click:e.backTarck}},[e._v("返回列表")]):a("el-button",{attrs:{type:"primary"},on:{click:e.addTarck}},[e._v("新增")])],1)]),a("MapViewer",{directives:[{name:"show",rawName:"v-show",value:e.isShow,expression:"isShow"}],ref:"mapFence",staticClass:"map-content",attrs:{zoom:12,domMap:"container1",checkShow:!0},on:{drawClick:e.drawClick}}),e.isShow?e._e():a("div",{staticClass:"table-list"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"table-item",attrs:{data:e.tableData,width:"100% ",height:"string","element-loading-text":"数据加载中","header-cell-style":{"text-align":"center",color:"#606266",background:"#fafafa"},"cell-style":{"text-align":"center"},"element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.2)"}},[a("el-table-column",{attrs:{label:"序号",align:"center",width:"60"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e.filtersForm.page*e.filtersForm.size+t.$index+1))]}}],null,!1,3603512110)}),e._l(e.logColumns,(function(t){return[t.flag?a("el-table-column",{key:t.prop,attrs:{prop:t.prop,label:t.label,width:t.width,align:"center","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(l){return[a("span",[e._v(e._s(l.row[t.prop]))])]}}],null,!0)}):e._e()]})),a("el-table-column",{attrs:{label:"操作",align:"center",width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticClass:"g-text-btn",on:{click:function(a){return e.handleCheck(t.row)}}},[e._v("查看")]),a("span",{staticClass:"g-del-btn g-text-btn",on:{click:function(a){return e.handleDelete(t.row)}}},[e._v("删除")])]}}],null,!1,2911277939)})],2)],1)],1),a("el-dialog",{attrs:{visible:e.mapDialog,"close-on-click-modal":!1,width:"560px"},on:{"update:visible":function(t){e.mapDialog=t},closed:e.handleClose}},[a("template",{slot:"title"},[a("div",{staticClass:"el-dialog-title"},[e._v(e._s(e.title))])]),a("el-form",{ref:"callBackForm",staticClass:"callBackForm",attrs:{rules:e.ruleForm,model:e.callBackForm,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"围栏名称：",prop:"name"}},[a("el-input",{attrs:{clearable:"",maxlength:"500","show-word-limit":"",placeholder:"请输入围栏名称"},model:{value:e.callBackForm.name,callback:function(t){e.$set(e.callBackForm,"name",t)},expression:"callBackForm.name"}})],1),a("el-form-item",{attrs:{label:"有效时间：",prop:"timeAll"}},[a("el-date-picker",{attrs:{type:"datetimerange",format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss","start-placeholder":"开始日期","end-placeholder":"结束日期","picker-options":e.option},model:{value:e.callBackForm.timeAll,callback:function(t){e.$set(e.callBackForm,"timeAll",t)},expression:"callBackForm.timeAll"}})],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.mapDialog=!1}}},[e._v("关闭")]),a("el-button",{attrs:{type:"primary"},on:{click:e.handleAdd}},[e._v("确定")])],1)],2)],1)}),[],!1,null,"2f92e8e2",null).exports)}}]);