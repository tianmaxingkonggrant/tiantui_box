"use strict";(self.webpackChunkweb_client_video_gateway=self.webpackChunkweb_client_video_gateway||[]).push([[787],{31177:function(t,e,a){a.r(e),a.d(e,{default:function(){return s}}),a(21249),a(68309),a(41539),a(54747),a(92222);var i=a(94351),n=(e=a(15002),{name:"",props:{info:{type:Object,default:function(){}}},data:function(){return{svgData:[{key:1,icon:"video",name:"实时视频"},{key:2,icon:"phone",name:"对讲"},{key:3,icon:"photograph",name:"拍照"},{key:4,icon:"monitor",name:"语音监听"},{key:5,icon:"tts",name:"TTS语音"},{key:6,icon:"alarm",name:"报警设置"}],obj:{car_code:void 0,driver:void 0,device_uuid:void 0}}},mounted:function(){this.obj=this.info},methods:{close:function(){this.$emit("clickshow","close")},initialize:function(t){this.obj=t},handleInfo:function(t){},showInfo:function(t){this.$emit("clickshow",t)}}}),s=(a=a(43736),n=(0,a.Z)(n,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"info-page"},[a("div",{staticClass:"del-div"},[a("div",{staticClass:"font-name"},[t._v(t._s(t.obj.car_code||"-"))]),a("div",{staticClass:"icon-item",on:{click:function(e){return t.close()}}},[a("i",{staticClass:"el-icon-close"})])]),a("div",{staticClass:"info-content"},[a("div",{staticClass:"info-item"},[a("label",{staticClass:"info-label"},[t._v("司机：")]),a("span",[t._v(t._s(t.obj.driver))])]),a("div",{staticClass:"info-item"},[a("label",{staticClass:"info-label"},[t._v("设备ID：")]),a("span",[t._v(t._s(t.obj.device_uuid))])]),a("div",{staticClass:"info-item"},[a("label",{staticClass:"info-label"},[t._v("状态：")]),a("span",[t._v(t._s(0===t.obj.status?"离线":"在线"))])]),a("div",{staticClass:"info-item"},[a("label",{staticClass:"info-label"},[t._v("限速：")]),a("span",[t._v(t._s(t.obj.limited_speed)+" km/h")])])]),a("div",{staticClass:"info-footer"},t._l(t.svgData,(function(e,i){return a("div",{key:i,staticClass:"info-footer-item",on:{click:function(a){return t.handleInfo(e)}}},[a("el-tooltip",{attrs:{content:e.name,placement:"top"}},[a("svg-icon",{staticClass:"svg-icon",attrs:{"icon-class":e.icon}})],1)],1)})),0)])}),[],!1,null,"47a5bbde",null).exports,e={components:{MapViewer:e.g,InfoWindow:n},data:function(){return{timer:null,loading:!1,statusFlag:!1,startMap:null,activeName:"first",data:[],dataOther:[],info:{},total:0,onLine:0,offLine:0,defaultProps:{children:"children",label:"car_code"}}},mounted:function(){this.getList()},destroyed:function(){clearInterval(this.timer)},methods:{getList:function(t){var e=this,a=(this.loading=!0,this),n=!1,s="";t&&t.did?(s=t.did,n=!0):(n=!1,this.data=[{id:1,car_code:"车辆监控",children:[]}]),(0,i.getDevices)({did:s}).then((function(t){var i,s;e.loading=!1,200===t.code&&(n?(i=t.data[0],s=[i.lng,i.lat],e.statusFlag&&a.data[0].children.map((function(t){var n;return i.did!==t.did||i.lat===t.lat&&i.lng===t.lng||(n={refItemForm:a.$refs.infoWindow,data:i},a.$refs.mapItem.mapCore.allDriverMarker==={}&&a.$refs.mapItem.getAddCenterChlidren(s,16),e.$refs.mapItem.mapCore.map.setFitView(),a.$refs.mapItem.moveTrackMarksStart(i,"",a.$refs.infoWindow.$el,n)),t}))):(a.data[0].children=t.data,a.onLine=0,a.offLine=0,t.data.map((function(t){return 0===t.status?a.offLine++:a.onLine++,t})),a.total=t.total_count))})).catch((function(t){e.loading=!1}))},showInfo:function(t){"close"===t&&this.$refs.mapItem.clearInfoWindowsChlidren()},handleTabs:function(t){var e=this;(0,i.getDevices)().then((function(a){if(e.loading=!1,200===a.code){e.onLine=0,e.offLine=0,e.data[0].children=a.data.map((function(t){return 0===t.status?e.offLine++:e.onLine++,t}));var i=[];switch(t.name){case"first":break;case"second":a.data.forEach((function(t){1===t.status&&i.push(t)})),e.data[0].children=[].concat(i);break;default:a.data.forEach((function(t){0===t.status&&i.push(t)})),e.data[0].children=[].concat(i)}}}))},nodeChange:function(t,e,a){var i,n=this,s=(this.$refs.tree.getCheckedNodes(),!1);s=!!e;this.statusFlag=s,this.info=t,this.$refs.mapItem&&t.lng&&t.lat&&(s={refItemForm:this.$refs.infoWindow,data:t},i=[t.lng,t.lat],this.$refs.mapItem.clearInfoWindowsChlidren(),e?(this.$refs.mapItem.getAddCenterChlidren(i,16),this.$refs.mapItem.mapCore.map.setFitView(),this.$refs.mapItem.moveTrackMarksStart(t,"",this.$refs.infoWindow.$el,s),this.timer=setInterval((function(){n.getList(n.info)}),2e3)):this.moveCar(t))},moveCar:function(t){this.$refs.mapItem.moveOnlyMarker(t.did+""),this.$refs.mapItem.clearInfoWindowsChlidren(),clearInterval(this.timer)}}},(0,a.Z)(e,(function(){var t=this,e=t.$createElement;e=t._self._c||e;return e("div",{staticClass:"page"},[e("div",{staticClass:"contetn-map"},[e("div",{staticClass:"left"},[e("div",{staticClass:"bus-titlt"},[t._v("车辆列表")]),e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"list-content"},[e("el-tabs",{on:{"tab-click":t.handleTabs},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[e("el-tab-pane",{attrs:{label:"全部("+t.total+")",name:"first"}}),e("el-tab-pane",{attrs:{label:"在线("+t.onLine+")",name:"second"}}),e("el-tab-pane",{attrs:{label:"离线("+t.offLine+")",name:"third"}})],1),e("div",[e("el-tree",{ref:"tree",attrs:{data:t.data,"node-key":"did","default-expand-all":"","check-on-click-node":"","check-strictly":"",props:t.defaultProps,"expand-on-click-node":!1,"highlight-current":""},on:{"check-change":t.nodeChange}})],1)],1)]),e("MapViewer",{ref:"mapItem",staticClass:"map-content",attrs:{zoom:12,domMap:"container",checkShow:!0}}),e("InfoWindow",{ref:"infoWindow",staticClass:"info-list",attrs:{info:t.info},on:{clickshow:t.showInfo}})],1)])}),[],!1,null,"19809f84",null).exports)}}]);